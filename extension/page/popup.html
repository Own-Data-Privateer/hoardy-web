<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>pWebArc: Settings</title>
    <link rel="shortcut icon" type="image/svg" href="../icon/main.svg">
    <link rel="stylesheet" href="main.css">
    <style>
body {
    min-width: 300px;
    line-height: 160%;
}

h1 {
    font-size: 110%;
    margin: 0;
    margin-top: 5px;
    display: flex;
}

h2 {
    font-size: 100%;
    margin: 0;
    margin-top: 2px;
}

code {
    margin: 0 0.5em;
}

.right {
    margin-left: auto;
}

.version {
    font-size: 60%;
    color: rgb(107,107,116);
    vertical-align: top;
}

.stats > div {
    margin-left: 1em;
    display: flex;
}

#help {
    margin-left: 1em;
}

.help-tip {
    left: 10%;
    right: 10%;
}

input[type="button"], .help-btn {
    vertical-align: top;
}

#show {
    width: 99%;
    text-align: center;
    margin: 5px;
}

.disabled-archiving {
    --text-background: var(--uncheckbox-background);
    --text-border-color: var(--uncheckbox-border-color);
}

.disabled-collecting {
    --checkbox-background: var(--uncheckbox-background);
    --checkbox-border-color: var(--uncheckbox-border-color);
}
    </style>
  </head>
  <body style="display: none">
    <div id="main">
      <h1>
        Globally
        <span class="version">v<span id="stats.version">?</span></span>
        <span data-help="Open the help page."><input type="button" id="help" value="Help" /></span>
        <span class="right">
          <span name="more">
            <span data-help="Flush the log of finished requests and zero out &quot;Taken&quot; and &quot;Discarded&quot; stats."><input type="button" id="forgetHistory" value="Flush" /></span>
          </span>
          <span data-help="Open the request log and internal state page."><input type="button" id="state" value="📜" /></span>
        </span>
      </h1>
      <div class="stats">
        <div id="div-stats.archive_ok" data-help="Number of reqres (HTTP requests+responses) successfully archived to the server.">
          <span>Archived</span>
          <span class="right"><span id="stats.archive_ok">0</span> reqres</span>
        </div>
        <div id="div-stats.archive_failed" data-help="Number of reqres that failed to be archived to the server.">
          <span>Failed to archive</span>
          <span class="right">
            <span data-help="Retry archiving reqres that failed to archive. I.e., move all failed to archive reqres to the archiving queue. This action will be performed automatically every 60 seconds when archiving is enabled."><input type="button" id="retryAllFailedArchives" value="♻" /></span>
            <span id="stats.archive_failed">0</span> reqres
          </span>
        </div>
        <div id="div-stats.queued" data-help="Number of finished reqres waiting to be archived.">
          <span>In queue</span>
          <span class="right"><span id="stats.queued">0</span> reqres</span>
        </div>
        <div id="div-stats.taken" data-help="Number of finished reqres that satisfied the archiving conditions and thus were taken for archival.">
          <span>Taken</span>
          <span class="right"><span id="stats.taken">0</span> reqres</span>
        </div>
        <div id="div-stats.discarded" data-help="Number of finished reqres that failed to satisfy the archiving conditions and thus were discarded.">
          <span>Discarded</span>
          <span class="right"><span id="stats.discarded">0</span> reqres</span>
        </div>
        <div id="div-stats.in_limbo" data-help="Number of finished reqres in limbo.">
          <span>In limbo</span>
          <span class="right">
            <span data-help="Queue all reqres in limbo for archival."><input type="button" id="takeAllInLimbo" value="✔️" /></span>
            <span data-help="Discard all reqres in limbo."><input type="button" id="discardAllInLimbo" value="✖️" /></span>
            <span id="stats.in_limbo">0</span> reqres
          </span>
        </div>
        <div id="div-stats.problematic" data-help="Number of finished problematic reqres in all tabs.">
          <span>Problematic</span>
          <span class="right">
            <span data-help="Forget about all problematic reqres."><input type="button" id="forgetProblematic" value="🧹" /></span>
            <span id="stats.problematic">0</span> reqres
          </span>
        </div>
        <div id="div-stats.in_flight" data-help="Number of tracked reqres that have not finished yet.">
          <span>In flight</span>
          <span class="right">
            <span data-help="Stop tracking progress of all in-flight requests and either queue them for archival or fail them, depending on completion and &quot;Archive reqres with&quot; options."><input type="button" id="stopAllInFlight" value="⏹" /></span>
            <span id="stats.in_flight">0</span> reqres
          </span>
        </div>
      </div>
      <ui id="config.collecting" type="boolean" data-help="Also known as &quot;Enable this add-on&quot;. Generate a new reqres and start tracking its progress when the browser makes a new HTTP request. Disabling this option will stop pWebArc from recording any new data.">Track newly generated requests</ui>
      <div name="more">
        <ui id="config.archiving" type="boolean" data-help="Archive already collected reqres (&quot;queued for archival&quot; in the stats) by submitting their dumps to the server at the following URL. Disabling this will stop pWebArc from trying to archive already collected data. Note that the archival queue is stored in memory, so you probably should not disable this unless you want to atomically change server-side profile settings or your server is temporarily down and you are annoyed by the error notifications.">Archive collected reqres</ui>
        <div name="depends">
          <ui id="config.archiveURLBase" type="string" data-help="URL of the server we are archiving to.">Archive to</ui>
        </div>
      </div>
      <div name="depends">
        <h1>This tab
          <span class="right">
            <span name="more">
              <span data-help="Forget about all the finished requests produced by this tab (and subtract them from &quot;Taken&quot; and &quot;Discarded&quot; stats)."><input type="button" id="forgetTabHistory" value="Flush" /></span>
            </span>
            <span data-help="Open the request log and internal state page narrowed to this tab's data."><input type="button" id="tabState" value="📜" /></span>
          </span>
        </h1>
        <div class="stats">
          <div id="div-tabstats.taken" data-help="Number of finished reqres of this tab that satisfied the archiving conditions and thus were taken for archival.">
            <span>Taken</span>
            <span class="right"><span id="tabstats.taken">0</span> reqres</span>
          </div>
          <div id="div-tabstats.discarded" data-help="Number of finished reqres of this tab that failed to satisfy the archiving conditions and thus were discarded.">
            <span>Discarded</span>
            <span class="right"><span id="tabstats.discarded">0</span> reqres</span>
          </div>
          <div id="div-tabstats.in_limbo" data-help="Number of in-limbo finished reqres generated by this tab.">
            <span>In limbo</span>
            <span class="right">
              <span data-help="For reqres of this tab, queue all reqres in limbo for archival."><input type="button" id="takeTabInLimbo" value="✔️" /></span>
              <span data-help="For reqres of this tab, discard all reqres in limbo."><input type="button" id="discardTabInLimbo" value="✖️" /></span>
              <span id="tabstats.in_limbo">0</span> reqres
            </span>
          </div>
          <div id="div-tabstats.problematic" data-help="Number of finished problematic reqres in this tab.">
            <span>Problematic</span>
            <span class="right">
              <span data-help="Forget about all problematic reqres in this tab."><input type="button" id="forgetTabProblematic" value="🧹" /></span>
              <span id="tabstats.problematic">0</span> reqres
            </span>
          </div>
          <div id="div-tabstats.in_flight" data-help="Number of in-flight reqres tracked in this tab.">
            <span>In flight</span>
            <span class="right">
              <span data-help="For reqres of this tab, stop tracking progress of all in-flight requests and either queue them for archival or fail them, depending on completion and &quot;Archive reqres with&quot; options."><input type="button" id="stopTabInFlight" value="⏹" /></span>
              <span id="tabstats.in_flight">0</span> reqres
            </span>
          </div>
        </div>
        <ui id="tabconfig.collecting" type="boolean" data-help="Track new reqres originating from this tab.">Track new reqres generated by this tab</ui>
        <ui id="tabconfig.limbo" type="boolean" data-help="Put newly finished reqres originating from this tab into limbo until you queue them for archival or discard them manually.">Put newly finished reqres in limbo</ui>
        <div name="more">
          <ui id="tabconfig.profile" type="string" data-help="Use this server-side profile when archiving reqres originating from this tab.">Profile</ui>
        </div>
        <h1>This tab's new children</h1>
        <ui id="tabconfig.children.collecting" type="boolean" data-help="Enable &quot;Track new reqres generated by this tab&quot; option in new tabs spawned from this tab (middle mouse click, context menu actions).">Enable tracking in new children tabs</ui>
        <ui id="tabconfig.children.limbo" type="boolean" data-help="Enable &quot;Put newly finished reqres in limbo&quot; option in new tabs spawned from this tab (middle mouse click, context menu actions).">Enable limbo in new children tabs</ui>
        <div name="more">
          <ui id="tabconfig.children.profile" type="string" data-help="Use this server-side profile when archiving reqres originating from new tabs opened from this tab (middle mouse click, context menu actions).">Profile</ui>
        </div>
        <h1>New root tabs</h1>
        <ui id="config.root.collecting" type="boolean" data-help="Enable &quot;Track new reqres generated by this tab&quot; option in new tabs opened via browser's &quot;New Tab&quot; browser action (new tabs created via the plus sign in the tab bar, Control+T, &quot;New Tab&quot; menu item). This setting also gets applied to all open tabs when pWebArc is (re)loaded.">Enable tracking in new root tabs</ui>
        <ui id="config.root.limbo" type="boolean" data-help="Enable &quot;Put newly finished reqres in limbo&quot; option in new tabs opened via browser's &quot;New Tab&quot; browser action (new tabs created via the plus sign in the tab bar, Control+T, &quot;New Tab&quot; menu item). This setting also gets applied to all open tabs when pWebArc is (re)loaded.">Enable limbo in new root tabs</ui>
        <div name="more">
          <ui id="config.root.profile" type="string" data-help="Use this server-side profile when archiving reqres originating from new tabs opened via browser's &quot;New Tab&quot; browser action (new tabs created via the plus sign in the tab bar, Control+T, &quot;New Tab&quot; menu item). This setting also gets applied to all open tabs when pWebArc is (re)loaded.">Profile</ui>
        </div>
      </div>
    </div>

    <input type="button" id="show" value="Show all" />

    <div name="more">
      <div name="depends">
        <h1>Originating from extensions</h1>
        <ui id="config.extension.collecting" type="boolean" data-help="Track new reqres originating from other browser extensions.">Track new reqres generated by them</ui>
        <ui id="config.extension.limbo" type="boolean" data-help="Put newly finished reqres originating from other browser extensions into limbo until you queue them for archival or discard them manually.">Put newly finished reqres in limbo</ui>
        <ui id="config.extension.profile" type="string" data-help="Use this server-side profile when archiving reqres originating from other browser extensions.">Profile</ui>
        <h1>Other background tasks</h1>
        <ui id="config.background.collecting" type="boolean" data-help="Track new reqres originating from browser's background tasks (excluding those originating from extensions). With the default browser config you probably should not disable this, as browsers do link pre-fetching in background, and disabling this will miss that data.">Track new reqres generated by them</ui>
        <ui id="config.background.limbo" type="boolean" data-help="Put newly finished reqres originating from browser's background tasks (excluding those originating from extensions) into limbo until you queue them for archival or discard them manually.">Put newly finished reqres in limbo</ui>
        <ui id="config.background.profile" type="string" data-help="Use this server-side profile when archiving reqres originating from browser's background tasks (excluding those originating from extensions).">Profile</ui>
        <h1>Options</h1>
        <div id="problematic-options">
          <h2>Mark reqres as problematic when they finish</h2>
          <ui id="config.markProblematicCanceled" type="boolean" data-help="Mark newly finished reqres as problematic if they finish in `canceled` state. Disabled by default because `canceled` state usually means the HTTP request in question was blocked by another extension like &quot;uBlock Origin&quot;. See Help page for details.">... in <code>canceled</code> state</ui>
          <ui id="config.markProblematicNoResponse" type="boolean" data-help="Mark newly finished reqres as problematic if they finish in `no_response` state. Enabled by default. See Help page for details.">... in <code>no_response</code> state</ui>
          <ui id="config.markProblematicIncomplete" type="boolean" data-help="Mark newly finished reqres as problematic if they finish in `incomplete` state. Enabled by default. See Help page for details.">... in <code>incomplete</code> state</ui>
          <ui id="config.markProblematicIncompleteFC" type="boolean" data-help="Mark newly finished reqres as problematic if they finish in `incomplete_fc` state. Disabled by default because `incomplete_fc` means the document was loaded from cache, which usually means one of the previously taken reqres had this response data archived already. See Help page for details.">... in <code>incomplete_fc</code> state</ui>
        </div>
        <div id="archive-options">
          <h2>Archive reqres with</h2>
          <ui id="config.archivePartialRequest" type="boolean" data-help="Queue a reqres for archival even when its request body is incomplete. You probably want to keep this enabled. See the &quot;Quirks and Bugs&quot; section of the &quot;Help&quot; page for details.">... partial POST form data</ui>
          <ui id="config.archiveNoResponse" type="boolean" data-help="Queue a reqres for archival even when there was no response, i.e. request was interrupted before request headers were received (this usually means a networking issue). Disabled by default because such archived reqress carry no information except that the browser tried to do a request at specified time.">... no responses</ui>
          <ui id="config.archiveIncompleteResponse" type="boolean" data-help="Queue a reqres for archival even when its response body is incomplete (e.g. response body was interrupted in the middle by a networking issue). Disabled by default because simply reloading the page and not dealing with partial files is usually a better option.">... incomplete response bodies</ui>
        </div>
        <div id="misc-options">
          <h2>Misc</h2>
          <ui id="config.debugging" type="boolean" data-help="Dump lots of data into extension's debugging log (in Firefox: about:debugging; in Chromium: extension inspector). This will make things very slow and will eat lots of memory. Do not enable unless you know what you are doing.">Verbose debugging log (SLOW!)</ui>
          <ui id="config.dumping" type="boolean" data-help="Dumps raw CBOR outputs to extension's debugging log. Does nothing when the previous option is not enabled. Makes things even slower and eats even more memory. Do not enable unless you know what you are doing.">Dump raw CBORs into the log</ui>
        </div>
      </div>
    </div>
    <script src="../lib/compat.js"></script>
    <script src="../lib/utils.js"></script>
    <script src="popup.js"></script>
  </body>
</html>
