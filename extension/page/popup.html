<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>pWebArc: Settings</title>
    <link rel="shortcut icon" type="image/svg" href="../icon/main.svg">
    <link rel="stylesheet" href="main.css">
    <style>
body {
    min-width: 300px;
    line-height: 160%;
}

h1 {
    font-size: 110%;
    margin: 0;
    margin-top: 5px;
    display: flex;
}

h2 {
    font-size: 100%;
    margin: 0;
    margin-top: 2px;
}

code {
    margin: 0 0.5em;
}

.version {
    font-size: 60%;
    color: rgb(107,107,116);
    vertical-align: top;
}

.stats > div {
    display: flex;
}

.stats > div > span:nth-child(1) {
    margin-left: 1em;
}

.stats > div > span:nth-child(2) {
    padding-left: 1em;
    margin: 0 1em 0 auto;
}

.stats > div > span:nth-child(3) {
    min-width: 5em;
    text-align: right;
}

#help {
    margin-left: 1em;
}

.help-tip {
    left: 10%;
    right: 10%;
}

input[type="button"], .help-btn {
    vertical-align: top;
}

#show {
    width: 99%;
    text-align: center;
    margin: 5px;
}

.disabled-archiving .da {
    --text-background: var(--uncheckbox-background);
    --text-border-color: var(--uncheckbox-border-color);
}

.disabled-collecting .dc {
    --checkbox-background: var(--uncheckbox-background);
    --checkbox-border-color: var(--uncheckbox-border-color);
}
    </style>
  </head>
  <body style="display: none">
    <h1>
      Globally
      <span class="version">v<span id="stats.version">?</span></span>
      <span data-help="Open the help page."><input type="button" id="help" value="Help" /></span>
      <span class="right">
        <span data-help="Forget history."><input type="button" id="forgetHistory" value="🧹" /></span>
        <span data-help="Show the internal state and history."><input type="button" id="showState" value="📜" /></span>
      </span>
    </h1>
    <div class="stats">
      <div id="div-stats.archived" data-help="The numbers of reqres that were: successfully archived to the server (+still in the archiving queue) / failed to be archived to the server.">
        <span>Archived/Failed</span>
        <span>
          <span data-help="Retry archiving reqres that failed to archive. I.e., move all failed to archive reqres to the archiving queue. This action will be performed automatically every 60 seconds when archiving is enabled."><input type="button" id="retryAllFailedArchives" value="♻" /></span>
        </span>
        <span>
          <span id="stats.archive_ok">0</span>
          (+<span id="stats.in_queue">0</span>)
          /
          <span id="stats.archive_failed">0</span>
        </span>
      </div>
      <div id="div-stats.collected" data-help="The numbers of finished reqres that were collected for archival / discarded from memory.">
        <span>Collected/Discarded</span>
        <span>
        </span>
        <span>
          <span id="stats.collected">0</span>
          /
          <span id="stats.discarded">0</span>
        </span>
      </div>
      <div id="div-stats.in_limbo" data-help="The number of finished reqres in limbo.">
        <span>In limbo</span>
        <span>
          <span data-help="Collect all reqres in limbo."><input type="button" id="collectAllInLimbo" value="✔️" /></span>
          <span data-help="Discard all reqres in limbo."><input type="button" id="discardAllInLimbo" value="✖️" /></span>
        </span>
        <span id="stats.in_limbo">0</span>
      </div>
      <div id="div-stats.picked" data-help="The number of reqres that satisfied &quot;Pick reqres for archival when they finish&quot; / the number of those that did not (at the moment they `finished`).">
        <span>Picked/Dropped</span>
        <span>
        </span>
        <span>
          <span id="stats.picked">0</span>
          /
          <span id="stats.dropped">0</span>
        </span>
      </div>
      <div id="div-stats.problematic" data-help="The number of reqres that satisfied &quot;Mark reqres as problematic when they finish&quot; conditions (at the moment they `finished`).">
        <span>Problematic</span>
        <span>
          <span data-help="Forget about all problematic reqres."><input type="button" id="forgetProblematic" value="🧹" /></span>
        </span>
        <span id="stats.problematic">0</span>
      </div>
      <div id="div-stats.in_flight" data-help="The number of reqres that have not finished yet.">
        <span>In flight</span>
        <span>
          <span data-help="Stop tracking progress of all in-flight reqres and either pick or drop them, depending on their completion and &quot;Pick reqres for archival when they finish&quot; options."><input type="button" id="stopAllInFlight" value="⏹" /></span>
        </span>
        <span id="stats.in_flight">0</span>
      </div>
    </div>

    <div name="more">
    <ui id="config.collecting" type="boolean" data-help="Also known as &quot;Enable this add-on&quot;. Generate a new reqres and start tracking its progress when the browser makes a new HTTP request. Disabling this option will stop pWebArc from recording any new data. Already tracked reqres will still get tracked until they finish.">Track newly generated requests</ui>
    <ui id="config.archiving" type="boolean" data-help="Archive collected reqres by submitting their dumps to the server at the following URL. Disabling this will stop pWebArc from trying to archive already collected data. Note that the archival queue is stored in memory, so you probably should not disable this unless you want to atomically change server-side profile settings or your server is temporarily down and you are annoyed by the error notifications.">Archive collected reqres</ui>
    <ui id="config.archiveURLBase" type="string" class="da" data-help="URL of the server we are archiving to.">to URL</ui>
    </div>

    <h1>This tab
      <span class="right">
        <span data-help="For reqres of this tab, forget history."><input type="button" id="forgetTabHistory" value="🧹" /></span>
        <span data-help="For reqres of this tab, show the internal state and history."><input type="button" id="showTabState" value="📜" /></span>
      </span>
    </h1>
    <div class="stats">
      <div id="div-tabstats.collected" data-help="For this tab, the numbers of finished reqres that were collected for archival / discarded from memory.">
        <span>Collected/Discarded</span>
        <span>
        </span>
        <span>
          <span id="tabstats.collected">0</span>
          /
          <span id="tabstats.discarded">0</span>
        </span>
      </div>
      <div id="div-tabstats.in_limbo" data-help="For this tab, the number of finished reqres in limbo.">
        <span>In limbo</span>
        <span>
          <span data-help="For reqres of this tab, collect all reqres in limbo."><input type="button" id="collectTabInLimbo" value="✔️" /></span>
          <span data-help="For reqres of this tab, discard all reqres in limbo."><input type="button" id="discardTabInLimbo" value="✖️" /></span>
        </span>
        <span id="tabstats.in_limbo">0</span>
      </div>
      <div id="div-tabstats.picked" data-help="For this tab, the number of reqres that satisfied &quot;Pick reqres for archival when they finish&quot; / the number of those that did not (at the moment they `finished`).">
        <span>Picked/Dropped</span>
        <span>
        </span>
        <span>
          <span id="tabstats.picked">0</span>
          /
          <span id="tabstats.dropped">0</span>
        </span>
      </div>
      <div id="div-tabstats.problematic" data-help="For this tab, the number of reqres that satisfied &quot;Mark reqres as problematic when they finish&quot; conditions (at the moment they `finished`).">
        <span>Problematic</span>
        <span>
          <span data-help="For reqres of this tab, forget about all problematic reqres."><input type="button" id="forgetTabProblematic" value="🧹" /></span>
        </span>
        <span id="tabstats.problematic">0</span>
      </div>
      <div id="div-tabstats.in_flight" data-help="For this tab, the number of in-flight reqres that have not finished yet.">
        <span>In flight</span>
        <span>
          <span data-help="For reqres of this tab, stop tracking progress of all in-flight requests and either collect them for archival or fail them, depending on completion and &quot;Pick reqres for archival when they finish&quot; options."><input type="button" id="stopTabInFlight" value="⏹" /></span>
        </span>
        <span id="tabstats.in_flight">0</span>
      </div>
    </div>
    <ui id="tabconfig.collecting" class="dc" type="boolean" data-help="Track new reqres originating from this tab.">Track new reqres</ui>
    <ui id="tabconfig.limbo" type="boolean" data-help="For this tab, put newly `finished` reqres tab that satisfy &quot;Pick reqres for archival when they finish&quot; settings into limbo until you collect them for archival or discard them manually.">Pick into limbo</ui>

    <div name="more">
    <ui id="tabconfig.profile" class="da" type="string" data-help="Use this server-side profile when archiving reqres originating from this tab.">Profile</ui>
    </div>

    <h1>This tab&#039;s new children</h1>
    <ui id="tabconfig.children.collecting" class="dc" type="boolean" data-help="Enable &quot;Track new reqres&quot; option in new tabs spawned from this tab (via middle mouse click, context menu actions).">Enable &quot;Track new reqres&quot;</ui>
    <ui id="tabconfig.children.limbo" type="boolean" data-help="Enable &quot;Pick into limbo&quot; option in new tabs spawned from this tab (via middle mouse click, context menu actions).">Enable &quot;Pick into limbo&quot;</ui>

    <div name="more">
    <ui id="tabconfig.children.profile" class="da" type="string" data-help="Use this server-side profile when archiving reqres originating from new tabs opened from this tab (middle mouse click, context menu actions).">Profile</ui>
    </div>

    <h1>New root tabs</h1>
    <ui id="config.root.collecting" class="dc" type="boolean" data-help="Enable &quot;Track new reqres&quot; option in new tabs opened via browser&#039;s &quot;New Tab&quot; browser action (new tabs created via the plus sign in the tab bar, Control+T, &quot;New Tab&quot; menu item). This setting also gets applied to all open tabs when pWebArc is (re)loaded.">Enable &quot;Track new reqres&quot;</ui>
    <ui id="config.root.limbo" type="boolean" data-help="Enable &quot;Pick into limbo&quot; option in new tabs opened via browser&#039;s &quot;New Tab&quot; action (new tabs created via the plus sign in the tab bar, Control+T, &quot;New Tab&quot; menu item). This setting also gets applied to all open tabs when pWebArc is (re)loaded.">Enable &quot;Pick into limbo&quot;</ui>

    <div name="more">
    <ui id="config.root.profile" class="da" type="string" data-help="Use this server-side profile when archiving reqres originating from new tabs opened via browser&#039;s &quot;New Tab&quot; browser action (new tabs created via the plus sign in the tab bar, Control+T, &quot;New Tab&quot; menu item). This setting also gets applied to all open tabs when pWebArc is (re)loaded.">Profile</ui>
    <h1>Background tasks</h1>
    <ui id="config.background.collecting" class="dc" type="boolean" data-help="Track new reqres originating from browser&#039;s background tasks (excluding those originating from extensions). With the default browser config you probably should not disable this as browsers do link pre-fetching in background, and disabling this will miss that data.">Track new reqres</ui>
    <ui id="config.background.limbo" type="boolean" data-help="For reqres originating from browser&#039;s background tasks (excluding those originating from extensions), put newly `finished` reqres tab that satisfy &quot;Pick reqres for archival when they finish&quot; settings into limbo until you collect them for archival or discard them manually.">Pick into limbo</ui>
    <ui id="config.background.profile" class="da" type="string" data-help="Use this server-side profile when archiving reqres originating from browser&#039;s background tasks (excluding those originating from extensions).">Profile</ui>
    <h1>Extensions</h1>
    <ui id="config.extension.collecting" class="dc" type="boolean" data-help="Track new reqres originating from browser extensions.">Track new reqres</ui>
    <ui id="config.extension.limbo" type="boolean" data-help="For reqres originating from browser&#039;s extensions/add-ons, put newly `finished` reqres tab that satisfy &quot;Pick reqres for archival when they finish&quot; settings into limbo until you collect them for archival or discard them manually.">Pick into limbo</ui>
    <ui id="config.extension.profile" class="da" type="string" data-help="Use this server-side profile when archiving reqres originating from browser extensions.">Profile</ui>
    <h1>Options</h1>
    <div id="pick-options">
      <h2>Pick reqres for archival when they finish</h2>
      <ui id="config.archivePartialRequest" type="boolean" data-help="Pick a finished reqres for archival even when its request body is incomplete. Enabled by default, and you probably want to keep this enabled. See the &quot;Quirks and Bugs&quot; section of the Help page for details.">... with partial POST form data</ui>
      <ui id="config.archiveCanceled" type="boolean" data-help="Pick a finished reqres for archival even when it was canceled before it was even sent (this usually means the HTTP request in question was blocked by another extension like &quot;uBlock Origin&quot;). Disabled by default because such archived reqres carry no information except that the browser tried to do a request at specified time.">... in <code>canceled</code> state</ui>
      <ui id="config.archiveNoResponse" type="boolean" data-help="Pick a finished reqres for archival even when it got no response (i.e. the request in question was interrupted before request headers were received, this usually means a networking issue). Disabled by default because such archived reqres carry no information except that the browser tried to do a request at specified time.">... in <code>no_response</code> state</ui>
      <ui id="config.archiveIncompleteResponse" type="boolean" data-help="Pick a finished reqres for archival even when its response body is incomplete (e.g. response body was interrupted in the middle by a networking issue). Disabled by default because simply reloading the page and not dealing with partial files is usually a better option.">... in <code>incomplete</code> or <code>incomplete_fc</code> state</ui>
    </div>
    <div id="problematic-options">
      <h2>Mark reqres as problematic when they finish</h2>
      <ui id="config.markProblematicPartialRequest" type="boolean" data-help="Marke a newly finished reqres as problematic when its request body is incomplete. Enabled by default. See the &quot;Quirks and Bugs&quot; section of the Help page for details.">... with partial POST form data</ui>
      <ui id="config.markProblematicCanceled" type="boolean" data-help="Mark a newly finished reqres as problematic when it was canceled before it was even sent (this usually means the HTTP request in question was blocked by another extension like &quot;uBlock Origin&quot;). Disabled by default.">... in <code>canceled</code> state</ui>
      <ui id="config.markProblematicNoResponse" type="boolean" data-help="Mark a newly finished reqres as problematic when it got no response (i.e. the request in question was interrupted before request headers were received; this usually means a networking issue). Enabled by default.">... in <code>no_response</code> state</ui>
      <ui id="config.markProblematicIncomplete" type="boolean" data-help="Mark a newly finished reqres as problematic when its response body is incomplete (e.g. response body was interrupted in the middle by a networking issue). Enabled by default.">... in <code>incomplete</code> state</ui>
      <ui id="config.markProblematicIncompleteFC" type="boolean" data-help="Mark a newly finished reqres as problematic when it was loaded from browser's cache but its response data was not given to the extension (this only happens on Firefox-based browsers). Disabled by default because this usually means that one of the previously collected reqres had this response data archived already, if had not, you can reload the page with browser's cache disabled via `Contrlol+F5`.">... in <code>incomplete_fc</code> state</ui>
    </div>
    <div id="debugging-options">
      <h2>Debugging</h2>
      <ui id="config.debugging" type="boolean" data-help="Dump lots of data into extension&#039;s debugging log (in Firefox: about:debugging; in Chromium: extension inspector). This will make things very slow and will eat lots of memory. Do not enable unless you know what you are doing.">Verbose debugging log (SLOW!)</ui>
      <ui id="config.dumping" type="boolean" data-help="Dumps raw CBOR outputs to extension&#039;s debugging log. Does nothing when the previous option is not enabled. Makes things even slower and eats even more memory. Do not enable unless you know what you are doing.">Dump raw CBORs into the log</ui>
    </div>
    </div>

    <input type="button" id="show" value="Show all" />

    <script src="../lib/compat.js"></script>
    <script src="../lib/utils.js"></script>
    <script src="../lib/lutils.js"></script>
    <script src="popup.js"></script>
  </body>
</html>
